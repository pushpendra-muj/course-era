function GetBookForBookMap() { $.ajax({ url: RootPath + "/ajax.aspx?bookids=" + bookids, cache: !1, success: function (o) { "NoBookFound" != o && mapCallback(o) } }) } function LoadBookMap() { map = new google.maps.Map(document.getElementById(MapID), { center: new google.maps.LatLng(sStartLat, sStartLng), disableDefaultUI: !0, disableDoubleClickZoom: !0, mapTypeId: MAP_TYPE, scrollwheel: !1, zoom: 3 }), "BigView" == MapView ? map.setOptions({ mapTypeControl: !0, panControl: !0, zoomControl: !0, zoomControlOptions: { style: google.maps.ZoomControlStyle.SMALL } }) : "ShortView" == MapView && map.setOptions({ draggable: !1 }), GetBookForBookMap() } function mapCallback(o) { var a = numMarkers - 1; null != mapData[0] && mapData[0].setMap(null); for (var t = 0; a > t; t++) mapData[t] = mapData[t + 1]; mapData[a] = DisplayBookMarker(o), null !== lastTimeoutId && window.clearTimeout(lastTimeoutId), ++loopNumber <= maxRequestsPerSession && (lastTimeoutId = window.setTimeout("GetBookForBookMap()", requestFrequency)) } function DisplayBookMarker(o) { var a = o.split("~"); bookids.split(","); return bookids += a[0] + ",", point = createMapPoint(parseFloat(a[7]), parseFloat(a[8])), loopNumber += 1, createMarker(point, createPopupHtml(o)) } function createMapPoint(o, a) { return new google.maps.LatLng(o, a) } function createPopupHtml(o) { var a, t = o.split("~"); return a = '<div class="popup-down">', a += '<table cellpadding="0" border="0" class="BookMapPopUpContainer"><tr><td class="BookThumbContainer">', a += '<a href="' + t[9] + '"><img alt="" width="65" height="100" src="' + t[1] + '" class="BookThumb" onerror="handleInvalidImages(this,\'image65\')"/></a></td><td>', a += '<table border="0" class="BookLocationContainer">', a += '<tr><td valign="top" class="BookLocationName">', a += '<td><img alt="" width="16" height="16" src="' + RootPath + '/images/icons/location.png"/></td>', a += '<td class="BookInfoContainer" >Someone in ' + t[3] + ",&nbsp;" + t[2] + " bought...</td>", a += "</tr>", a += '<tr><td valign="top" class="BookLocationName">', a += '<td><img alt="" width="16" height="16" src="' + RootPath + '/images/icons/cart.png"/></td>', a += '<td class="BookInfoContainer" style="font-size:12px;"><a href="' + t[9] + '"><strong>' + t[5] + "</strong></a></td>", a += "</tr>", a += '<tr><td valign="top" class="BookLocationName">', a += '<td><img alt="" width="16" height="16" src="' + RootPath + '/images/icons/time.png"/></td>', a += '<td class="BookInfoContainer"><i>' + t[6] + " minutes ago</i></td>", a += "</tr>", a += "</table>", a += "</td></tr></table>", a += "</div>" } function createMarker(o, a) { var t = new google.maps.Marker({ map: map, position: o, icon: { url: RootPath + ICON_FILE, size: new google.maps.Size(ICON_WIDTH_PX, ICON_HEIGHT_PX) }, shadow: { url: RootPath + SHADOW_FILE, size: new google.maps.Size(SHADOW_WIDTH_PX, SHADOW_HEIGHT_PX) } }); if (map.panTo(o), map.panBy(MAP_OFFSET_WIDTH_PX, MAP_OFFSET_HEIGHT_PX), null == t.infoWindowInstance) { var e = new google.maps.InfoWindow({ content: a }); e.open(map, t), t.infoWindowInstance = e, google.maps.event.addListener(e, "domready", function () { $(".gm-style-iw").each(function () { $(this).parent().hasClass("bdmarker") || ($(this).parent().addClass("bdmarker"), $(this).parent().addClass("bdln" + loopNumber)); var o = getLnFromClass($(this).parent()); $(this).parent().css("z-index", 100 * parseInt(o)); var a = 0; $(this).parent().children().each(function () { a++, $(this).addClass("bdiw" + a); var o = 0; $(this).children().each(function () { o++, $(this).addClass("bdiwg" + o); var a = 0; $(this).children().each(function () { a++, $(this).addClass("bdiwgg" + a) }) }) }) }) }) } return t } function getLnFromClass(o) { var a = 0, t = o.attr("class").split(/\s+/); return $.each(t, function (o, t) { t.indexOf("bdln") >= 0 && (a = t.substr(4)) }), a } function setUpTracking() { var o = "BigView" == MapView ? "big map" : "mini map"; $("img.bookImage").click(function () { try { pageTracker._trackEvent("map", "book image", o) } catch (a) { } return !0 }), $(".bookTitle").click(function () { try { pageTracker._trackEvent("map", "book title", o) } catch (a) { } return !0 }) } var INFO_HEIGHT_PX = 108, INFO_WIDTH_PX = 208, INFO_MARGIN_TOP_PX = 6, JACKET_HEIGHT_PX = 80, JACKET_WIDTH_PX = 75, POINTER_HEIGHT_PX = 25, ICON_FILE = "/images/icons/CustomMarker.png", ICON_HEIGHT_PX = 20, ICON_WIDTH_PX = 12, SHADOW_FILE = "/images/icons/CustomMarkerShadow.png", SHADOW_HEIGHT_PX = 20, SHADOW_WIDTH_PX = 22, MAP_OFFSET_HEIGHT_PX = -70, MAP_OFFSET_WIDTH_PX = 80, MAP_TYPE = google.maps.MapTypeId.ROADMAP, map, bookids = "8C8CB340-E4E6-4BB4-A57E-3FE4411E43B1,", loopNumber = 0, PreviousDisplayedInfoWindow = null, PreviousDisplayedGMarker = null, lastTimeoutId = null, maxRequestsPerSession = 100, requestFrequency = 5e3; window.onload = new Function("LoadBookMap()"); var mapData = { 0: null, 1: null, 2: null, 3: null, 4: null }, numMarkers = "BigView" == MapView ? 5 : 1;